<div
	class="pane"
	style="
		left: {pane.getLeft() * 100}%;
		top: {pane.getTop() * 100}%;
		width: {pane.getWidth() * 100}%;
		height: {pane.getHeight() * 100}%;
	"
	on:mousedown="handleMousedown(this, event)"
>
	<div class="inner">
		<svelte:component this={component} {pane}/>
	</div>
</div>

<style>
	.pane {
		position: absolute;
		overflow: hidden;
		box-sizing: border-box;
		padding: calc(var(--thickness) / 2);
	}

	.inner {
		position: relative;
		width: 100%;
		height: 100%;
		overflow: hidden;
	}
</style>

<script>
	import * as constants from './constants.js';

	const THRESHOLD = 100;

	const isMac = navigator.platform === 'MacIntel';

	function wasCmdOrCtrlPressed(event) {
		return isMac ? event.metaKey : event.ctrlKey;
	}

	export default {
		methods: {
			handleMousedown(node, event) {
				if (!wasCmdOrCtrlPressed(event)) return;

				const { top, right, bottom, left } = node.getBoundingClientRect();
				const { items } = this.get();

				const d = [
					[constants.NORTH, event.clientY - top],
					[constants.SOUTH, bottom - event.clientY],
					[constants.EAST, right - event.clientX],
					[constants.WEST, event.clientX -left]
				];

				if (d[0][1] > THRESHOLD && d[1][1] > THRESHOLD && d[2][1] > THRESHOLD && d[3][1] > THRESHOLD) return;

				d.sort((a, b) => a[1] - b[1]);

				this.fire('split', {
					edge: d[0][0],
					clientX: event.clientX,
					clientY: event.clientY
				});
			}
		}
	};
</script>